 # ADR-002: Валидация входных данных с помощью Pydantic и строгих ограничений полей
 Date: 2025-10-22
 Status: Accepted

 ## Context
 API принимает JSON-пейлоады для упражнений, тренировок и подходов. Некоторые поля не имели строгих ограничений (например, длина `note`), что повышало риск попадания неожиданных данных в БД и возможного DoS при слишком больших полях.

 ## Decision
 Использовать Pydantic-модели с явными ограничениями (min/max длины строк, границы для чисел) для всех публичных моделей запросов. Валидировать на границе API и полагаться на FastAPI/Pydantic для возвращения 422 при некорректных входных данных.

 ## Alternatives
 - Оставить валидацию на уровне БД (отклонено: поздняя ошибка, плохой UX).
 - Использовать отдельную библиотеку валидации (отклонено: дублирование функциональности FastAPI/Pydantic).

 ## Consequences
 - Более строгая валидация уменьшит попадание некорректных данных в БД и поможет соответствовать NFR.
 - Тесты должны проверять поведение валидации (ответ 422) для некорректных запросов.

 ## Security impact
 Предотвращает ряд атак, связанных с вводом (слишком большие поля, неправильные типы) и помогает выполнить NFR-03 и NFR-05.

 ## Definition of Done
 - Все публичные Pydantic-схемы имеют явные ограничения на поля (lengths, bounds).
 - Есть unit-тесты, покрывающие негативные кейсы (422).
 - CI зелёный.

 ## Rollout plan
 1. Обновить схемы в feature-ветке.
 2. Добавить тесты и запустить CI.
 3. Поэтапный rollout после проверки тестов.

 ## Owner
 - @backend-team (primary)

 ## Links
 - NFR-03 (валидация)
 - RISKS: R2, R4
 - Issue #15 (Pydantic validation enforcement)
 - PR: will be linked after PR creation
