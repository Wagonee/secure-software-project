# STRIDE для Workout Log API

Анализ угроз по методологии STRIDE для ключевых потоков данных из DFD. Контроли связаны с NFR из `docs/security-nfr/NFR.md`.

| # | Поток/Элемент | STRIDE-категория | Угроза | Контроль | Ссылка на NFR | Проверка |
|---|---------------|------------------|---------|-----------|---------------|-----------|
| 1 | F1: Client → GW | S (Spoofing) | Неавторизованный доступ к данным чужих тренировок | Аутентификация и авторизация на всех эндпоинтах | NFR-02 | API-тесты (401/403) |
| 2 | F1: POST /workouts | T (Tampering) | Изменение данных тренировки через перехват запроса | TLS, валидация Pydantic моделей | NFR-03 | Unit-тесты моделей |
| 3 | F2: Rate limiting | D (DoS) | DoS через массовые запросы | Rate limiting: 100 req/min per IP | NFR-05 | Нагрузочное тестирование |
| 4 | F3: DB операции | I (Information) | Утечка данных через логи/ошибки | Минимизация данных в логах, корректная обработка ошибок | NFR-08 | Ревью логов, e2e тесты |
| 5 | F4: Validation | E (Elevation) | Обход валидации через специально сформированные данные | Строгая валидация: reps > 0, weight >= 0 | NFR-03 | Тесты валидации |
| 6 | SVC (все эндпоинты) | R (Repudiation) | Отсутствие аудита действий пользователя | Логирование всех 5xx ошибок | NFR-08 | Проверка логов |
| 7 | DB (данные) | I (Information) | Утечка PII при экспорте/бэкапе | Минимизация хранимых данных, подготовка к шифрованию | NFR-02 | Security review |
| 8 | VAL (валидация) | T (Tampering) | Слишком большие заметки к тренировкам | Ограничение размера note ≤ 1000 символов | NFR-04 | API-тесты (422) |

## Приоритетные контроли
1. Аутентификация/авторизация (NFR-02, Critical)
2. Валидация входных данных (NFR-03, High)
3. Rate limiting (NFR-05, High)
4. Логирование ошибок (NFR-08, Medium)

## Обоснование контролей
- Аутентификация - требуется для всех эндпоинтов с данными пользователя (US-04)
- Валидация предотвращает некорректные данные в БД (US-02)
- Rate limiting защищает от DoS и автоматизированных атак
- Логирование необходимо для отладки и аудита проблем